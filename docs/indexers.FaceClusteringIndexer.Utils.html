---

title: Export -


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/indexers.FaceClusteringIndexer.Utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/indexers.FaceClusteringIndexer.Utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="confidence2clusters" class="doc_header"><code>confidence2clusters</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L21" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>confidence2clusters</code>(<strong><code>confidences</code></strong>, <strong><code>dists</code></strong>, <strong><code>nbrs</code></strong>, <strong><code>tau</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="group_clusters" class="doc_header"><code>group_clusters</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L26" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>group_clusters</code>(<strong><code>photos</code></strong>, <strong><code>cluster_labels</code></strong>, <strong><code>min_cluster_size</code></strong>=<em><code>2</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sparse_mx_to_indices_values" class="doc_header"><code>sparse_mx_to_indices_values</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L30" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sparse_mx_to_indices_values</code>(<strong><code>sparse_mx</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="sparse_mx_to_torch_sparse_tensor" class="doc_header"><code>sparse_mx_to_torch_sparse_tensor</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L37" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sparse_mx_to_torch_sparse_tensor</code>(<strong><code>sparse_mx</code></strong>)</p>
</blockquote>
<p>Convert a scipy sparse matrix to a torch sparse tensor.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="indices_values_to_sparse_tensor" class="doc_header"><code>indices_values_to_sparse_tensor</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L42" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>indices_values_to_sparse_tensor</code>(<strong><code>indices</code></strong>, <strong><code>values</code></strong>, <strong><code>shape</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="build_symmetric_adj" class="doc_header"><code>build_symmetric_adj</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L48" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>build_symmetric_adj</code>(<strong><code>adj</code></strong>, <strong><code>self_loop</code></strong>=<em><code>True</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="row_normalize" class="doc_header"><code>row_normalize</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L54" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>row_normalize</code>(<strong><code>mx</code></strong>)</p>
</blockquote>
<p>Row-normalize sparse matrix</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="peaks_to_edges" class="doc_header"><code>peaks_to_edges</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L65" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>peaks_to_edges</code>(<strong><code>peaks</code></strong>, <strong><code>dist2peak</code></strong>, <strong><code>tau</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="confidence_to_peaks" class="doc_header"><code>confidence_to_peaks</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L76" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>confidence_to_peaks</code>(<strong><code>dists</code></strong>, <strong><code>nbrs</code></strong>, <strong><code>confidence</code></strong>, <strong><code>max_conn</code></strong>=<em><code>1</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="peaks_to_labels" class="doc_header"><code>peaks_to_labels</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L107" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>peaks_to_labels</code>(<strong><code>peaks</code></strong>, <strong><code>dist2peak</code></strong>, <strong><code>tau</code></strong>, <strong><code>inst_num</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="build_knns" class="doc_header"><code>build_knns</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L112" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>build_knns</code>(<strong><code>knn_prefix</code></strong>, <strong><code>feats</code></strong>, <strong><code>knn_method</code></strong>, <strong><code>k</code></strong>, <strong><code>num_process</code></strong>=<em><code>None</code></em>, <strong><code>is_rebuild</code></strong>=<em><code>False</code></em>, <strong><code>feat_create_time</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="edge_to_connected_graph" class="doc_header"><code>edge_to_connected_graph</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L119" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>edge_to_connected_graph</code>(<strong><code>edges</code></strong>, <strong><code>num</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="knns2ordered_nbrs" class="doc_header"><code>knns2ordered_nbrs</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L135" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>knns2ordered_nbrs</code>(<strong><code>knns</code></strong>, <strong><code>sort</code></strong>=<em><code>True</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_meta" class="doc_header"><code>read_meta</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L148" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_meta</code>(<strong><code>fn_meta</code></strong>, <strong><code>start_pos</code></strong>=<em><code>0</code></em>, <strong><code>verbose</code></strong>=<em><code>True</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_probs" class="doc_header"><code>read_probs</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L165" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_probs</code>(<strong><code>path</code></strong>, <strong><code>inst_num</code></strong>, <strong><code>feat_dim</code></strong>, <strong><code>dtype</code></strong>=<em><code>float32</code></em>, <strong><code>verbose</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="fast_knns2spmat" class="doc_header"><code>fast_knns2spmat</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L178" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fast_knns2spmat</code>(<strong><code>knns</code></strong>, <strong><code>k</code></strong>, <strong><code>th_sim</code></strong>=<em><code>0.7</code></em>, <strong><code>use_sim</code></strong>=<em><code>False</code></em>, <strong><code>fill_value</code></strong>=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="l2norm" class="doc_header"><code>l2norm</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L207" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>l2norm</code>(<strong><code>vec</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="knn_faiss" class="doc_header"><code>class</code> <code>knn_faiss</code><a href="https://gitlab.memri.io/memri/pyintegrators/tree/prod/pyintegrators/indexers/faceclustering/utils.py#L212" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>knn_faiss</code>(<strong><code>feats</code></strong>, <strong><code>k</code></strong>, <strong><code>index_key</code></strong>=<em><code>''</code></em>, <strong><code>nprobe</code></strong>=<em><code>128</code></em>, <strong><code>omp_num_threads</code></strong>=<em><code>None</code></em>, <strong><code>rebuild_index</code></strong>=<em><code>True</code></em>, <strong><code>verbose</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

