---

title: WhatsApp Importer


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/importers.WhatsAppImporter.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/importers.WhatsAppImporter.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/home/bli/anaconda3/lib/python3.8/site-packages/torch/cuda/__init__.py:52: UserWarning: CUDA initialization: Found no NVIDIA driver on your system. Please check that you have an NVIDIA GPU and installed a driver from http://www.nvidia.com/Download/index.aspx (Triggered internally at  /pytorch/c10/cuda/CUDAFunctions.cpp:100.)
  return torch._C._cuda_getDeviceCount() &gt; 0
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This importer fetches your WhatsApp data such as contacts, chats and messages (including media files) from the WhatsApp server via a toolset of Matrix homeserver + service bridges. It contains two major components: (1) MatrixClient for communication with the Matrix homeserver via its Client-Server API, and (2) WhatsAppImporter for handling the logic of fetching data from WhatsApp server and creating data items/edges to be uploaded to the Pod.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Before the importer can start fetching data, the toolset of <a href="https://github.com/matrix-org/synapse">Matrix homeserver Synapse</a> + <a href="https://github.com/tulir/mautrix-whatsapp">WhatsApp bridge</a> need to be set up in advance. A Matrix user should be created, the username and token of the created user will be used to authenticate with Matrix homeserver. Additionally, a third-party web client for Matrix is needed (e.g., <a href="https://app.element.io/">Riot/Element</a>) for now, in order to use the bridge and authenticate with WhatsApp server.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Note that the authentication with WhatsApp server relies on WhatsApp web feature, meaning that you need to scan the QR code with the WhatsApp mobile app.</strong></p>
<p><strong>To invite the bridge bot to a Matrix room and authenticate with WhatsApp web:</strong></p>
<ul>
<li>Open in a web browser the Matrix client <a href="https://app.element.io/#/login">Element</a>, change the homeserver URL to your own URL used for homeserver installation (e.g. <em><a href="http://localhost:8008">http://localhost:8008</a></em> for a local installation).</li>
<li>Use the username and password for registration to login.</li>
<li>Create a new private group chat, remember to <strong>disable</strong> end-to-end encryption for this room (as it does not work yet for bridge bots).</li>
<li>Invite bridge bot to the room by sending the message<br/> <code>/invite @whatsappbot:$your_homeserver_domain</code></li>
<li>Send a message to login <code>login</code></li>
<li>Use the WhatsApp web on your phone app to scan the shown QR code for authentication.</li>
<li><strong>Accept all invitations</strong> to the rooms once logged in.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="MautrixWhatsapp">MautrixWhatsapp<a class="anchor-link" href="#MautrixWhatsapp"> </a></h2><p>This class is used for setting up the Mautrix-WhatsApp bridge, including generating configuration files and launching the bridge.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="MautrixWhatsapp" class="doc_header"><code>class</code> <code>MautrixWhatsapp</code><a href="integrators/importers/whatsapp.py#L47" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>MautrixWhatsapp</code>(<strong><code>hostname</code></strong>, <strong><code>bridge</code></strong>, <strong><code>user</code></strong>, <strong><code>data_dir</code></strong>, <strong><code>client</code></strong>, <strong><code>my_uid</code></strong>, <strong><code>my_gid</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="MautrixWhatsapp.config_whatsapp_bridge" class="doc_header"><code>MautrixWhatsapp.config_whatsapp_bridge</code><a href="integrators/importers/whatsapp.py#L66" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>MautrixWhatsapp.config_whatsapp_bridge</code>()</p>
</blockquote>
<p>Generate config files for whatsapp bridge</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="MautrixWhatsapp.run_bridge" class="doc_header"><code>MautrixWhatsapp.run_bridge</code><a href="integrators/importers/whatsapp.py#L100" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>MautrixWhatsapp.run_bridge</code>(<strong><code>networkname</code></strong>)</p>
</blockquote>
<p>Launch whatsapp bridge</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="WhatsAppImporter">WhatsAppImporter<a class="anchor-link" href="#WhatsAppImporter"> </a></h2><p>This class provides methods to the frontend for calling the methods in the MatrixClient class. It also handles the processing of the fetched data, and creates data items to be uploaded to the Pod.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>WhatsAppImporter takes the following parameters:</p>
<ul>
<li><strong>matrix</strong>: Matrix instance</li>
<li><strong>matrix_client</strong>: MatrixClient instance</li>
<li><strong>hostname</strong>: Hostname of Matrix homeserver </li>
<li><strong>matrix_address</strong>: URL of Matrix homeserver</li>
<li><strong>prefix_service</strong>: Prefix of Matrix username, indicating the service</li>
<li><strong>bot_name</strong>: Name of whatsappbot</li>
<li><strong>username</strong>: Registered Matrix username</li>
<li><strong>password</strong>: Password of registered Matrix user</li>
<li><strong>dir</strong>: Directory to store configuration and database files</li>
<li><strong>matrix_acc</strong>: Matrix account for registered user</li>
<li><strong>matrix_token</strong>: Token associated with Matrix user</li>
</ul>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="WhatsAppImporter" class="doc_header"><code>class</code> <code>WhatsAppImporter</code><a href="integrators/importers/whatsapp.py#L115" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>WhatsAppImporter</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwargs</code></strong>) :: <code>ImporterBase</code></p>
</blockquote>
<p>Provides a base class for all items. All items in the schema inherit from this class, and it provides some
basic functionality for consistency and to enable easier usage.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="WhatsAppImporter.create_account" class="doc_header"><code>WhatsAppImporter.create_account</code><a href="integrators/importers/whatsapp.py#L241" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>WhatsAppImporter.create_account</code>(<strong><code>user_id</code></strong>)</p>
</blockquote>
<p>Create Account item for each user_id</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="WhatsAppImporter.create_message_channel" class="doc_header"><code>WhatsAppImporter.create_message_channel</code><a href="integrators/importers/whatsapp.py#L251" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>WhatsAppImporter.create_message_channel</code>(<strong><code>room_id</code></strong>)</p>
</blockquote>
<p>Create MessageChannel item for each room, link with Account items</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="WhatsAppImporter.create_message" class="doc_header"><code>WhatsAppImporter.create_message</code><a href="integrators/importers/whatsapp.py#L267" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>WhatsAppImporter.create_message</code>(<strong><code>event</code></strong>, <strong><code>room</code></strong>)</p>
</blockquote>
<p>Create Message item for each event, link with MessageChannel and Account</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="WhatsAppImporter.create_media" class="doc_header"><code>WhatsAppImporter.create_media</code><a href="integrators/importers/whatsapp.py#L301" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>WhatsAppImporter.create_media</code>(<strong><code>content</code></strong>)</p>
</blockquote>
<p>Create media item in different types, link with File</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="WhatsAppImporter.import_all_accounts" class="doc_header"><code>WhatsAppImporter.import_all_accounts</code><a href="integrators/importers/whatsapp.py#L328" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>WhatsAppImporter.import_all_accounts</code>(<strong><code>all_rooms</code></strong>, <strong><code>users</code></strong>)</p>
</blockquote>
<p>Import all created Account items to Pod</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="WhatsAppImporter.import_all_messagechannels" class="doc_header"><code>WhatsAppImporter.import_all_messagechannels</code><a href="integrators/importers/whatsapp.py#L342" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>WhatsAppImporter.import_all_messagechannels</code>(<strong><code>all_rooms</code></strong>)</p>
</blockquote>
<p>Import all created MessageChannel items to Pod</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="WhatsAppImporter.import_all_messages" class="doc_header"><code>WhatsAppImporter.import_all_messages</code><a href="integrators/importers/whatsapp.py#L351" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>WhatsAppImporter.import_all_messages</code>(<strong><code>next_batch</code></strong>)</p>
</blockquote>
<p>Import all created Message items to Pod</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="WhatsAppImporter.run" class="doc_header"><code>WhatsAppImporter.run</code><a href="integrators/importers/whatsapp.py#L366" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>WhatsAppImporter.run</code>(<strong><code>importer_run</code></strong>, <strong><code>pod_client</code></strong>=<em><code>None</code></em>, <strong><code>verbose</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>This is the main function of WhatsAppImporter, which runs based on the information of importer_run.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Tests">Tests<a class="anchor-link" href="#Tests"> </a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Without-Matrix-homeserver+bridge">Without Matrix homeserver+bridge<a class="anchor-link" href="#Without-Matrix-homeserver+bridge"> </a></h2><p>Create MessageChannel and Message items, add edge in between, upload to Pod.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DB_KEY</span> <span class="o">=</span> <span class="s2">&quot;C070BDD19BD248C2A31DCBBE85FF701C9C4E54C6AB474405B5B7C298F49188D0&quot;</span>
<span class="n">OWNER_KEY</span> <span class="o">=</span> <span class="s2">&quot;CDFA58CEDDD92508FCA6C509B56BE2693B63C6063902D25151F40E84E6740771&quot;</span>

<span class="n">pod_client</span> <span class="o">=</span> <span class="n">PodClient</span><span class="p">(</span><span class="n">database_key</span><span class="o">=</span><span class="n">DB_KEY</span><span class="p">,</span> <span class="n">owner_key</span><span class="o">=</span><span class="n">OWNER_KEY</span><span class="p">)</span>
<span class="n">pod_client</span><span class="o">.</span><span class="n">delete_all</span><span class="p">()</span>

<span class="n">message_channel</span> <span class="o">=</span> <span class="n">MessageChannel</span><span class="p">(</span><span class="n">externalId</span><span class="o">=</span><span class="s2">&quot;!scbkDPfWMZqpqyjnsS:synapse&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Test&quot;</span><span class="p">,</span> <span class="n">topic</span><span class="o">=</span><span class="s2">&quot;Private chat&quot;</span><span class="p">)</span>
<span class="n">pod_client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">message_channel</span><span class="p">)</span>

<span class="n">event</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;m.room.message&#39;</span><span class="p">,</span> <span class="s1">&#39;sender&#39;</span><span class="p">:</span> <span class="s1">&#39;@foo:synapse&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;msgtype&#39;</span><span class="p">:</span> <span class="s1">&#39;m.text&#39;</span><span class="p">,</span> <span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="s1">&#39;list contacts&#39;</span><span class="p">},</span> <span class="s1">&#39;origin_server_ts&#39;</span><span class="p">:</span> <span class="mi">1606235079767</span><span class="p">,</span> <span class="s1">&#39;unsigned&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;age&#39;</span><span class="p">:</span> <span class="mi">59529472</span><span class="p">},</span> <span class="s1">&#39;event_id&#39;</span><span class="p">:</span> <span class="s1">&#39;$biXu9En8lvI7gxfV1O6_4SxgBtI6HpcTMr6oZtEJSz4&#39;</span><span class="p">}</span>
<span class="n">message</span> <span class="o">=</span> <span class="n">Message</span><span class="p">(</span><span class="n">externalId</span><span class="o">=</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;event_id&quot;</span><span class="p">],</span> <span class="n">importJson</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">event</span><span class="p">[</span><span class="s2">&quot;content&quot;</span><span class="p">]),</span> <span class="n">service</span><span class="o">=</span><span class="s2">&quot;whatsapp&quot;</span><span class="p">)</span>
<span class="n">message</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s2">&quot;messageChannel&quot;</span><span class="p">,</span> <span class="n">message_channel</span><span class="p">)</span>
<span class="n">pod_client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
<span class="n">pod_client</span><span class="o">.</span><span class="n">create_edges</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">get_all_edges</span><span class="p">())</span>

<span class="k">assert</span> <span class="n">pod_client</span><span class="o">.</span><span class="n">external_id_exists</span><span class="p">(</span><span class="n">message_channel</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span>
<span class="k">assert</span> <span class="n">pod_client</span><span class="o">.</span><span class="n">external_id_exists</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">==</span> <span class="kc">True</span>

<span class="n">pod_client</span><span class="o">.</span><span class="n">delete_all</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="With-Matrix-homeserver+bridge">With Matrix homeserver+bridge<a class="anchor-link" href="#With-Matrix-homeserver+bridge"> </a></h2><p><strong>Require to first register with Matrix, update username and token.</strong></p>
<p>Import contacts, chats and messages and upload to Pod.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DB_KEY</span> <span class="o">=</span> <span class="s2">&quot;C070BDD19BD248C2A31DCBBE85FF701C9C4E54C6AB474405B5B7C298F49188D0&quot;</span>
<span class="n">OWNER_KEY</span> <span class="o">=</span> <span class="s2">&quot;CDFA58CEDDD92508FCA6C509B56BE2693B63C6063902D25151F40E84E6740771&quot;</span>
<span class="n">USERNAME</span> <span class="o">=</span> <span class="n">OWNER_KEY</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">]</span>
<span class="n">PASSWORD</span> <span class="o">=</span> <span class="n">get_random_alphanumeric_string</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">HOSTNAME</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">USERNAME</span><span class="si">}</span><span class="s2">-synapse&quot;</span>
<span class="n">BRIDGENAME</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">USERNAME</span><span class="si">}</span><span class="s2">-mautrix-whatsapp&quot;</span>
<span class="n">DEFAULT_MATRIX_ADDRESS</span> <span class="o">=</span> <span class="s2">&quot;http://localhost:8008&quot;</span>
<span class="n">PREFIX_SERVICE</span> <span class="o">=</span> <span class="s2">&quot;@whatsapp_&quot;</span>
<span class="n">BOT_NAME</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;@whatsappbot:</span><span class="si">{</span><span class="n">HOSTNAME</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">pod_client</span> <span class="o">=</span> <span class="n">PodClient</span><span class="p">(</span><span class="n">database_key</span><span class="o">=</span><span class="n">DB_KEY</span><span class="p">,</span> <span class="n">owner_key</span><span class="o">=</span><span class="n">OWNER_KEY</span><span class="p">)</span>

<span class="n">whatsapp_importer</span> <span class="o">=</span> <span class="n">WhatsAppImporter</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;whatsapp&quot;</span><span class="p">)</span>
<span class="n">pod_client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">whatsapp_importer</span><span class="p">)</span>

<span class="n">ga_host</span> <span class="o">=</span> <span class="n">GenericAttribute</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;host&#39;</span><span class="p">,</span> <span class="n">stringValue</span><span class="o">=</span><span class="n">HOSTNAME</span><span class="p">)</span>
<span class="n">ga_bridge</span> <span class="o">=</span> <span class="n">GenericAttribute</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;bridge&#39;</span><span class="p">,</span> <span class="n">stringValue</span><span class="o">=</span><span class="n">BRIDGENAME</span><span class="p">)</span>
<span class="n">ga_address</span> <span class="o">=</span> <span class="n">GenericAttribute</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;address&#39;</span><span class="p">,</span> <span class="n">stringValue</span><span class="o">=</span><span class="n">DEFAULT_MATRIX_ADDRESS</span><span class="p">)</span>
<span class="n">ga_prefix</span> <span class="o">=</span> <span class="n">GenericAttribute</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;prefix&#39;</span><span class="p">,</span> <span class="n">stringValue</span><span class="o">=</span><span class="n">PREFIX_SERVICE</span><span class="p">)</span>
<span class="n">ga_bot</span> <span class="o">=</span> <span class="n">GenericAttribute</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;bot&#39;</span><span class="p">,</span> <span class="n">stringValue</span><span class="o">=</span><span class="n">BOT_NAME</span><span class="p">)</span>
<span class="n">pod_client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">ga_host</span><span class="p">)</span>
<span class="n">pod_client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">ga_bridge</span><span class="p">)</span>
<span class="n">pod_client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">ga_address</span><span class="p">)</span>
<span class="n">pod_client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">ga_prefix</span><span class="p">)</span>
<span class="n">pod_client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">ga_bot</span><span class="p">)</span>

<span class="n">importer_run</span> <span class="o">=</span> <span class="n">ImporterRun</span><span class="p">(</span><span class="n">progress</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">USERNAME</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">PASSWORD</span><span class="p">,</span> <span class="n">repository</span><span class="o">=</span><span class="s2">&quot;memri-pyintegrator:latest&quot;</span><span class="p">)</span>
<span class="n">importer_run</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s1">&#39;genericAttribute&#39;</span><span class="p">,</span> <span class="n">ga_host</span><span class="p">)</span>
<span class="n">importer_run</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s1">&#39;genericAttribute&#39;</span><span class="p">,</span> <span class="n">ga_bridge</span><span class="p">)</span>
<span class="n">importer_run</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s1">&#39;genericAttribute&#39;</span><span class="p">,</span> <span class="n">ga_address</span><span class="p">)</span>
<span class="n">importer_run</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s1">&#39;genericAttribute&#39;</span><span class="p">,</span> <span class="n">ga_prefix</span><span class="p">)</span>
<span class="n">importer_run</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s1">&#39;genericAttribute&#39;</span><span class="p">,</span> <span class="n">ga_bot</span><span class="p">)</span>
<span class="n">importer_run</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="s1">&#39;importer&#39;</span><span class="p">,</span> <span class="n">whatsapp_importer</span><span class="p">)</span>
<span class="n">pod_client</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">importer_run</span><span class="p">)</span>
<span class="n">pod_client</span><span class="o">.</span><span class="n">create_edges</span><span class="p">(</span><span class="n">importer_run</span><span class="o">.</span><span class="n">get_all_edges</span><span class="p">())</span>

<span class="n">whatsapp_importer</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">importer_run</span><span class="o">=</span><span class="n">importer_run</span><span class="p">,</span> <span class="n">pod_client</span><span class="o">=</span><span class="n">pod_client</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Call-run_importer-interface-of-the-Pod">Call run_importer interface of the Pod<a class="anchor-link" href="#Call-run_importer-interface-of-the-Pod"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DB_KEY</span> <span class="o">=</span> <span class="s2">&quot;C070BDD19BD248C2A31DCBBE85FF701C9C4E54C6AB474405B5B7C298F49188D0&quot;</span>
<span class="n">OWNER_KEY</span> <span class="o">=</span> <span class="s2">&quot;CDFA58CEDDD92508FCA6C509B56BE2693B63C6063902D25151F40E84E6740771&quot;</span>
<span class="n">pod_client</span> <span class="o">=</span> <span class="n">PodClient</span><span class="p">(</span><span class="n">database_key</span><span class="o">=</span><span class="n">DB_KEY</span><span class="p">,</span> <span class="n">owner_key</span><span class="o">=</span><span class="n">OWNER_KEY</span><span class="p">)</span>


<span class="n">query</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;databaseKey&#39;</span><span class="p">:</span><span class="n">pod_client</span><span class="o">.</span><span class="n">database_key</span><span class="p">,</span>
            <span class="s1">&#39;payload&#39;</span><span class="p">:{</span>
                 <span class="s1">&#39;uid&#39;</span><span class="p">:</span><span class="n">importer_run</span><span class="o">.</span><span class="n">uid</span><span class="p">,</span>
                 <span class="s1">&#39;servicePayload&#39;</span><span class="p">:</span> <span class="p">{</span>
                     <span class="s1">&#39;databaseKey&#39;</span><span class="p">:</span><span class="n">pod_client</span><span class="o">.</span><span class="n">database_key</span><span class="p">,</span>
                     <span class="s1">&#39;ownerKey&#39;</span><span class="p">:</span><span class="n">pod_client</span><span class="o">.</span><span class="n">owner_key</span>
                  <span class="p">},</span>
            <span class="p">}</span>
       <span class="p">}</span>

<span class="nb">print</span><span class="p">(</span><span class="n">importer_run</span><span class="o">.</span><span class="n">uid</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;http://0.0.0.0:3030/v2/</span><span class="si">{</span><span class="n">pod_client</span><span class="o">.</span><span class="n">owner_key</span><span class="si">}</span><span class="s1">/run_importer&#39;</span><span class="p">,</span>
                   <span class="n">json</span><span class="o">=</span><span class="n">query</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

